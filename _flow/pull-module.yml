id: pull-module
namespace: home.lab

inputs:

  - id: git_user
    type: STRING
    description: "Username from git"
    required: true
    defaults:
      - marcelobojikian

  - id: git_project
    type: STRING
    description: "Project from git"
    required: true
    defaults:
      - homelab

  - id: git_branch
    type: STRING
    description: "Project from git"
    required: true
    defaults:
      - main

  - id: git_module
    type: STRING
    description: "Folder from git"
    required: true
    defaults:
      - pve/ansible

tasks:

  - id: setup
    type: io.kestra.core.tasks.flows.WorkingDirectory
    tasks:

      - id: git
        type: io.kestra.plugin.git.Sync
        url: 'https://github.com/{{ inputs.git_user }}/{{ inputs.git_project }}.git'
        branch: '{{ inputs.git_branch }}'
        cloneSubmodules: true
        gitDirectory: '{{ inputs.git_module }}'
        namespaceFilesDirectory: dynamic/modules
        dryRun: true
